Senedd members have rejected a post-Brexit law on trade in the UK after claims it would "neuter" devolution.
They voted 36 to 15 against the UK government's Internal Market Bill, currently going through Westminster.
Opponents in Labour and Plaid Cymru say the bill, designed to help businesses keep trading, would centralise power in London.
The UK government said it was disappointed with the result of the vote.
The bill says products that can legally be sold in one part of the UK can be sold in all its nations.
It is meant to help businesses avoid rules making it more difficult to trade across the borders of the UK's nations.
But the Welsh Government says it would undermine the Senedd's ability to regulate goods and services.
The Scottish Parliament has already withheld its consent of the bill and there has been a similar vote against in the Northern Ireland Assembly.
In the chamber, Counsel General Jeremy Miles said the bill "neuters" the Senedd's ability to make laws.
Labour backbencher Alun Davies said: "Devolution is dead if this reaches the statute book."
The first version of the bill contained clauses giving UK ministers the power to override parts of the Brexit withdrawal deal, breaking international law in the process.
Although the UK government now plans to withdraw those clauses, Conservative MS David Melding said their inclusion in the first place had been "repugnant".
But other members of his party backed the bill.
For the Tories, Darren Millar said it would "protect the integrity of the UK's own single market".
That was "vastly more important to the people of Wales than the single market of the European Union ever was or could be", UKIP's Neil Hamilton said.
Abolish the Welsh Assembly Party Senedd member Mark Reckless said if the bill "results in us being unable to legislate to ban people in Wales from buying things that people in England are able to buy then that's something I would welcome."
A UK government spokesperson said: "Today's outcome in the Welsh Parliament is disappointing. 
"In conversations with businesses small and large across Wales, they have agreed that seamless trade across the UK is important for the Welsh economy to thrive. Around 75 per cent of Welsh exports go to England, Scotland and Northern Ireland and the UK Internal Market Bill will protect Welsh businesses and jobs by ensuring this unhindered trade continues." 
